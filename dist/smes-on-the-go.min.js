function showDrawer(){var e=document.querySelector(".mdl-layout");e.MaterialLayout.drawerToggleHandler_()}function createMap(){mobileOS=isMobile(),map=new GMaps({div:"#map",lat:-37.813942,lng:144.9711861,styles:iovation,zoom_changed:function(e){checkSizeofCurrentMap()},idle:function(e){queueRedraw()}}),setUpAutoComplete()}function geoLocate(){GMaps.geolocate({success:function(e){map.setCenter(e.coords.latitude,e.coords.longitude)}}),checkSizeofCurrentMap(),queueRedraw()}function queueRedraw(){redrawQueue.push(Date.now()),processQueue()}function processQueue(){var e=perNumberOfSeconds/maxRequests*1e3,t=Date.now()-lastQueueExecuteStartTime;redrawQueue.length>0&&(t>=e?executeRedrawFromQueue():window.setTimeout(function(){processQueue()},e-t+50))}function executeRedrawFromQueue(){redrawQueue.length>0&&(lastQueueExecuteStartTime=Date.now(),redrawQueue.length=0,redrawMapInfo())}function redrawMapInfo(){var e={};mapSpinner.classList.remove("hidden"),e.lat=map.getCenter().lat(),e.lng=map.getCenter().lng(),e.lat<-180&&(e.lat=e.lat+360),e.lng<-180&&(e.lng=e.lng+360),currentRadius>0&&2>=currentRadius?retrieveMarkInformation(e.lat,e.lng).then(function(e){e.length>0&&addMarkers(e),mapSpinner.classList.add("hidden")})["catch"](function(e){mapSpinner.classList.add("hidden"),console.log(e)}):mapSpinner.classList.add("hidden")}function returnMarkerIconType(e){var t,r,a,i,s;return t=!1,r=!1,a=!1,i=!1,s=!1,"OK"!=e.status?"mark-defective":("Yes"===e.scn&&(t=!0),""!==e.ahdHeight&&(a=!0),0===String(e.nineFigureNumber).indexOf("1")&&(r=!0),e.gda94Technique.indexOf(scnGDA94Value)>=0&&(i=!0),scnAHDValues.forEach(function(t){e.ahdTechnique.indexOf(t)>=0&&(s=!0)}),t||a?!t&&a?"mark-ahdapprox-pm":t&&r?"mark-scn-gda94-pcm":!t||a||r?t&&a&&!i?"mark-scn-ahd-pm":t&&a&&i&&s?"mark-scn-gda94-ahd-pm":t&&a&&i&&!s?"mark-scn-gda94-ahdapprox-pm":void 0:"mark-scn-gda94-pm":"mark-gda94approx-pm")}function addMarkers(e){var t,r,a,i=!1;a=map.getZoom(),16>a?r=12:a>=16&&17>a?r=14:a>=17&&19>a?r=16:a>=19&&21>a?(r=20,i=!0):(r=24,i=!0),displayingOverlays&&!i&&(map.removeOverlays(),loadedOverlays=[]),e.forEach(function(e){var a,s=returnMarkerIconType(e);if(t="symbology/"+s+"-"+r+".png",-1===loadedMarks.indexOf(e.nineFigureNumber))a=""!==mobileOS?'<button id="navigate'+e.nineFigureNumber+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color-text--primary smes-button fade-in">&nbsp;&nbsp;Navigate to mark&nbsp;&nbsp;</button>':"",map.addMarker({lat:e.latitude,lng:e.longitude,animation:google.maps.Animation.DROP,title:e.name,icon:t,infoWindow:{content:'<p class="mdl-color-text--primary"><b>'+e.name+"</b></p><hr><p>Nine Figure Number: "+e.nineFigureNumber+"</p><p>Status: "+e.status+"</p><p>SCN: "+e.scn+"</p><p>Zone: "+e.zone+"</p><p>Easting: "+e.easting+"</p><p>Northing: "+e.northing+"</p><p>AHD Height: "+e.ahdHeight+"</p><p>Ellipsoid Height: "+e.ellipsoidHeight+"</p><p>GDA94 Technique: "+e.gda94Technique+"</p><p>AHD Technique: "+e.ahdTechnique+"</p><hr>"+a+'<button id="sketch'+e.nineFigureNumber+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color-text--primary smes-button fade-in">&nbsp;&nbsp;View Mark Sketch&nbsp;&nbsp;</button><button id="report'+e.nineFigureNumber+'" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color-text--primary smes-button fade-in">&nbsp;&nbsp;View Mark Report&nbsp;&nbsp;</button>',domready:function(t){document.querySelector("[id=sketch"+e.nineFigureNumber+"]").addEventListener("click",getSurveyMarkSketch,!1),document.querySelector("[id=report"+e.nineFigureNumber+"]").addEventListener("click",getSurveyMarkReport,!1),""!==mobileOS&&document.querySelector("[id=navigate"+e.nineFigureNumber+"]").addEventListener("click",startNavigation,!1)}},click:function(t){currentNineFigureNumber=e.nineFigureNumber,currentLatLng.lat=e.latitude,currentLatLng.lng=e.longitude}}),loadedMarks.push(e.nineFigureNumber);else{var n=map.markers.filter(function(t){return t.title===e.name});n[0].icon!==t&&n[0].setIcon(t)}i&&(displayingOverlays=!0,-1===loadedOverlays.indexOf(e.nineFigureNumber)&&(map.drawOverlay({lat:e.latitude,lng:e.longitude,verticalAlign:"bottom",horiztonalAlign:"center",content:'<div class="overlay"><span class="overlay-text">'+e.name+"</span></div>"}),loadedOverlays.push(e.nineFigureNumber)))})}function isMobile(){var e=navigator.userAgent;return e.match(/Android/i)?"Android":e.match(/iPhone/i)||e.match(/iPad/i)?"iOS":""}function displayError(){errorMsg.classList.remove("hidden"),errorMsg.textContent="Too many requests have been sent to the server.  Please wait...",window.setTimeout(function(){clearError()},1e3)}function clearError(){errorMsg.classList.add("hidden")}function setUpAutoComplete(){input=document.getElementById("pac-input"),searchMarker=new google.maps.Marker({map:map.map,anchorPoint:new google.maps.Point(0,-29)}),autoComplete=new google.maps.places.Autocomplete(input),autoComplete.bindTo("bounds",map.map),infoWindow=new google.maps.InfoWindow,autoComplete.addListener("place_changed",function(){infoWindow.close(),searchMarker.setVisible(!1);var e=autoComplete.getPlace();if(e.geometry){e.geometry.viewport?map.map.fitBounds(e.geometry.viewport):(map.map.setCenter(e.geometry.location),map.setZoom(17)),queueRedraw(),searchMarker.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),searchMarker.setPosition(e.geometry.location),searchMarker.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),infoWindow.setContent("<div><strong>"+e.name+"</strong><br>"+t+"</div>"),infoWindow.open(map.map,searchMarker)}}),searchMarker.addListener("click",function(){infoWindow.open(map.map,searchMarker)})}function startNavigation(){if(clearError(),"number"==typeof currentLatLng.lat&&"number"==typeof currentLatLng.lng&&""!==mobileOS){var e;e="Android"===mobileOS?"google.navigation:q="+currentLatLng.lat+","+currentLatLng.lng:"http://maps.apple.com/?daddr="+currentLatLng.lat+","+currentLatLng.lng,window.open(e)}}function getSurveyMarkSketch(){clearError(),getSurveyMarkSketchResponse(currentNineFigureNumber).then(function(e){window.open("data:application/pdf;base64,"+encodeURI(e.document),"_blank")})["catch"](function(e){console.log(e),displayError(e)})}function getSurveyMarkReport(){clearError(),getSurveyMarkReportResponse(currentNineFigureNumber).then(function(e){window.open("data:application/pdf;base64,"+encodeURI(e.document),"_blank")})["catch"](function(e){console.log(e),displayError(e)})}function retrieveMarkInformation(e,t){return clearError(),mapSpinner.classList.remove("hidden"),new Promise(function(r,a){xr.get(baseURL+"/getMarkInformation",{searchType:"Location",latitude:e,longitude:t,radius:currentRadius,format:"Brief"}).then(function(e){"undefined"==typeof e.messages?(zoomInMsg.classList.add("hidden"),r(e.data)):"More than 250 marks were found for this search. Please refine your search criteria."===e.messages.message?(console.log("Too many marks"),mapSpinner.classList.add("hidden"),zoomInMsg.innerHTML=ZOOM_MSG_TEXT,zoomInMsg.classList.remove("hidden")):"No survey marks matched the criteria provided."===e.messages.message?(console.log("No marks found"),zoomInMsg.innerHTML=ZOOM_MSG_TEXT,mapSpinner.classList.remove("hidden")):(console.log(e.messages.message),displayError(e.messages.message),mapSpinner.classList.add("hidden"))})["catch"](function(e){return console.log(e),displayError(),Promise.reject(e)})})}function getSurveyMarkSketchResponse(e){return new Promise(function(t,r){xr.get(baseURL+"/getSurveyMarkSketches",{markList:e,returnDefective:!0}).then(function(e){"undefined"==typeof e.messages?t(e.data):console.log(e.messages.message)})["catch"](function(e){return console.log(e),displayError(),Promise.reject(e)})})}function getSurveyMarkReportResponse(e){return new Promise(function(t,r){xr.get(baseURL+"/getSurveyMarkReports",{markList:e,returnDefective:!0}).then(function(e){"undefined"==typeof e.messages?t(e.data):console.log(e.messages.message)})["catch"](function(e){return console.log(),Promise.reject(e)})})}function checkSizeofCurrentMap(){mapSpinner.classList.remove("hidden");var e=map.getBounds();if("undefined"!=typeof e){var t=getDistanceKms(map.getCenter().lat(),map.getCenter().lng(),map.getBounds().getSouthWest().lat(),map.getBounds().getSouthWest().lng());currentRadius=t/1e3}else currentRadius=0;currentRadius>0&&2>=currentRadius?zoomInMsg.classList.add("hidden"):(zoomInMsg.innerHTML=ZOOM_MSG_TEXT,zoomInMsg.classList.remove("hidden")),mapSpinner.classList.add("hidden")}function getDistanceKms(e,t,r,a){var i=6378137,s=calcRad(r-e),n=calcRad(a-t),o=Math.sin(s/2)*Math.sin(s/2)+Math.cos(calcRad(e))*Math.cos(calcRad(r))*Math.sin(n/2)*Math.sin(n/2),l=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)),p=i*l;return p}function calcRad(e){return e*Math.PI/180}function dataURItoBlob(e,t){for(var r=window.atob(e.split(",")[1]),a=(e.split(",")[0].split(":")[1].split(";")[0],new ArrayBuffer(r.length)),i=new Uint8Array(a),s=0;s<r.length;s++)i[s]=r.charCodeAt(s);var n=new Blob([a]);return n}var coolGrey=[{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{stylers:[{hue:"#00aaff"},{saturation:-100},{gamma:2.15},{lightness:12}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:24}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:57}]}],darkGrey=[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}],paleDawn=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2e5d4"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{lightness:20}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#acbcc9"}]}],shiftWorker=[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}],simpleLight=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#fcfcfc"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#fcfcfc"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]}],muted=[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"},{visibility:"simplified"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"simplified"},{saturation:"-65"},{lightness:"45"},{gamma:"1.78"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{saturation:"-33"},{lightness:"22"},{gamma:"2.08"}]},{featureType:"transit.station.airport",elementType:"geometry",stylers:[{gamma:"2.08"},{hue:"#ffa200"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{visibility:"simplified"},{saturation:"-55"},{lightness:"-2"},{gamma:"1.88"},{hue:"#ffab00"}]},{featureType:"water",elementType:"all",stylers:[{color:"#bbd9e5"},{visibility:"simplified"}]}],iovation=[{featureType:"all",elementType:"geometry",stylers:[{gamma:"0.82"}]},{featureType:"all",elementType:"geometry.fill",stylers:[{gamma:"1.21"}]},{featureType:"all",elementType:"labels",stylers:[{lightness:"-60"}]},{featureType:"all",elementType:"labels.text",stylers:[{gamma:"5.37"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#419d8c"},{lightness:"-39"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{saturation:"0"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#42738d"},{gamma:"5.37"}]}],map,input,searchMarker,autoComplete,infoWindow,currentNineFigureNumber,currentLatLng={},currentRadius,loadedMarks=[],loadedOverlays=[],mapSpinner,locateButton,zoomInMsg,errorMsg,displayingOverlays=!1,redrawQueue=[],maxRequests=30,perNumberOfSeconds=60,lastQueueExecuteStartTime,mobileOS,elTimer,baseURL="https://maps.land.vic.gov.au/lvis/services/smesDataDelivery",scnAHDValues=["ZEROTH ORDER","2ND ORDER","3RD ORDER","SPIRIT LEVELLING"],scnGDA94Value="ADJUSTMENT",pcmSearchText="PCM",ZOOM_MSG_TEXT='<span class="zoom-in-message-text">Zoom in to see marks</span>';window.addEventListener("load",function(e){lastQueueExecuteStartTime=Date.now(),mapSpinner=document.querySelector("[id=map-spinner]"),zoomInMsg=document.querySelector("[id=zoom-in-msg]"),errorMsg=document.querySelector("[id=error-msg]"),locateButton=document.querySelector("[id=locate]"),locateButton.addEventListener("click",geoLocate,!1),createMap(),geoLocate(),document.getElementById("hamburger-menu").addEventListener("click",showDrawer,!1)},!1);